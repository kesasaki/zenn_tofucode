---
title: "AWS CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èªè¨¼æƒ…å ±ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: 
  - "aws"
  - "iam"
  - "awscli"
published: true
---
# æ¦‚è¦
ECRåˆ©ç”¨ã®ãŸã‚ã«AWS CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨èªè¨¼æƒ…å ±ã®è¨­å®šã‚’è¡Œã†ã€‚
AWS CLIã¯ã‚³ãƒãƒ³ãƒ‰ã§AWSã®æ“ä½œã‚’è¡Œãˆã‚‹ãƒ„ãƒ¼ãƒ«ã€‚AWSã¯ãƒ–ãƒ©ã‚¦ã‚¶å´ã§ã‚‚è‰²ã€…è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãŒã€
ãã‚Œã¨ã‚³ãƒãƒ³ãƒ‰ã‚’ç¹‹ãè¾¼ã‚€ã®ãŒèªè¨¼æƒ…å ±ã®è¨­å®šã€‚

# AWS CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»¥ä¸‹ã«å¾“ã£ã¦AWS CLIã‚’å…¥ã‚Œã‚‹ã€‚
https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/getting-started-install.html

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```
curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
sudo installer -pkg AWSCLIV2.pkg -target /
```

## macOS installerã‚’å®Ÿè¡Œ
```
sudo installer -pkg ./AWSCLIV2.pkg -target /
```

## å®Ÿè¡Œç¢ºèªã¨å¾Œå§‹æœ«
```
which aws
aws --version
rm AWSCLIV2.pkg
```

# IAM Identity CenterçµŒç”±ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¢ºç«‹ã™ã‚‹
ä»¥ä¸‹ã«å¾“ã£ã¦IAM Identity CenterçµŒç”±ã§AWSã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã™ã‚‹
https://docs.aws.amazon.com/ja_jp/singlesignon/latest/userguide/getting-started.html

## ã‚¹ãƒ†ãƒƒãƒ—1: IAM Identity Center ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
ä»¥ä¸‹ç”»é¢ã§çµ„ç¹”ã‚’ä½œæˆã™ã‚‹ã€‚
![](/images/108b5310bd7712/ss22.jpg =700x)

ä»¥ä¸‹ç”»é¢ã§ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚
![](/images/108b5310bd7712/ss1.jpg =700x)

## ã‚¹ãƒ†ãƒƒãƒ— 2: ID ã‚½ãƒ¼ã‚¹ã‚’é¸æŠã™ã‚‹
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—

## ã‚¹ãƒ†ãƒƒãƒ— 3: ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚»ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹
ä»¥ä¸‹ã«å¾“ã£ã¦è¨­å®šã™ã‚‹ã€‚æ—¥æœ¬èªãŒæ€ªã—ã„ã€‚
https://docs.aws.amazon.com/ja_jp/singlesignon/latest/userguide/get-started-create-an-administrative-permission-set.html

è¨±å¯ã‚»ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹
![](/images/108b5310bd7712/ss23.jpg =700x)
ã€Œäº‹å‰å®šç¾©ã•ã‚ŒãŸè¨±å¯ã‚»ãƒƒãƒˆã€, ã€ŒAdministrator Accessã€ã‚’é¸æŠã—æ¬¡ã¸
![](/images/108b5310bd7712/ss24.jpg =700x)
è¨±å¯ã‚»ãƒƒãƒˆã®è©³ç´°ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾æ¬¡ã¸
ã§ããŸ
![](/images/108b5310bd7712/ss25.jpg =700x)

## ã‚¹ãƒ†ãƒƒãƒ— 4: AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨­å®šã™ã‚‹
ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆæ¸ˆã¿ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—

## ã‚¹ãƒ†ãƒƒãƒ— 5: AWS ç®¡ç†è€…ã®èªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒ¼ã‚¿ãƒ«ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã™ã‚‹
åˆ¥ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã§ããŸã€‚
![](/images/108b5310bd7712/ss26.jpg =700x)

## ã‚¹ãƒ†ãƒƒãƒ— 6: æœ€å°ç‰¹æ¨©ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’é©ç”¨ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚»ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹
ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§é‹ç”¨ã™ã‚‹ãŸã‚ã‚¹ã‚­ãƒƒãƒ—

# AWS CLIã®è¨­å®š
ä»¥ä¸‹ã«å¾“ã£ã¦AWS CLIã®è¨­å®šã‚’è¡Œã†ã€‚
https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/getting-started-quickstart.html

# AWS CLI ã®èªè¨¼æƒ…å ±ã®è¨­å®š 
AWS IAM Identity Center ã®è‡ªå‹•èªè¨¼æ›´æ–°ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¨­å®šã‚’è¡Œã†ã€‚

ä»¥ä¸‹ã«å¾“ã£ã¦æ“ä½œã‚’è¡Œã†ã€‚
https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/sso-configure-profile-token.html

## aws configure sso ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã™ã‚‹
ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§AWS IAM Identity Center ã®START URL, ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã€‚session nameã¯é©å½“ã§ã„ã„ã€‚
```
$ aws configure sso
SSO session name (Recommended): aichatbot-sso
SSO start URL [None]: https://XXXXXXXXXXXXX.awsapps.com/start
SSO region [None]: ap-southeast-2
SSO registration scopes [None]: sso:account:access
```
ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãAWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ã‚’æ±‚ã‚ã¦ãã‚‹ã€‚
å…ˆã»ã©ä½œã£ãŸãƒ¦ãƒ¼ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ä»¥ä¸‹ã®è¡¨ç¤ºãŒå‡ºã¦é€£æºãŒæˆåŠŸã™ã‚‹ã€‚
![](/images/108b5310bd7712/ss27.jpg =300x)

ã‚³ãƒãƒ³ãƒ‰ä¸Šã§ã¯å‡¦ç†ãŒç¶šãã€‚1ã¤ã—ã‹AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãªã„å ´åˆã¯è‡ªå‹•ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠãŒã•ã‚Œã‚‹
```
The only AWS account available to you is: xxxxxxxxxxxxxxx
Using the account ID xxxxxxxxxxxxxxx
The only role available to you is: AdministratorAccess
Using the role name "AdministratorAccess"
```

ãã®å¾Œã€å†ã³ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ã‚’å…¥åŠ›ã™ã‚‹ã€‚
```
CLI default client Region [None]: ap-southeast-2
CLI default output format [None]: json
CLI profile name [AdministratorAccess-xxxxxxxxxxxxxxx]:
```

å…¨ã¦å…¥åŠ›ã™ã‚‹ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã€‚
```
To use this profile, specify the profile name using --profile, as shown:

aws s3 ls --profile AdministratorAccess-xxxxxxxxxxxxxxx
```

ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã™ã‚‹
```
cat ~/.aws/config
[profile AdministratorAccess-xxxxxxxxxxxxxxx]
sso_session = aichatbot-sso
sso_account_id = xxxxxxxxxxxxxxx
sso_role_name = AdministratorAccess
region = ap-southeast-2
output = json
[sso-session aichatbot-sso]
sso_start_url = https://XXXXXXXXXXXXX.awsapps.com/start
sso_region = ap-southeast-2
sso_registration_scopes = sso:account:access
```

å®Œäº†ã€‚ã“ã‚Œã§`aws ecr-public get-login-password`ã¨ã‹ãŒã§ãã‚‹ã¯ãšã€‚
â†’ ã§ããŸã€‚
https://zenn.dev/tofucode/articles/b0f6282c323879

:::message
æ³¨æ„ï¼šaws configure ssoã¯expireãŒåˆ‡ã‚Œã‚‹ã”ã¨ã«å®Ÿè¡Œã™ã‚‹
:::