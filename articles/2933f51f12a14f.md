---
title: "[APIæ§‹ç¯‰8] Github Actionsã§ECRã¸pushã—ECSã¸ãƒ‡ãƒ—ãƒ­ã‚¤"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: 
 - "githubactions"
 - "AWS"
 - "ecs"
 - "ecr"
published: false
---
# æ¦‚è¦
ä»Šã¾ã§æ‰‹å‹•ã§pushã—ã¦ã„ãŸã‚‚ã®ã‚’CI/CDåŒ–ã™ã‚‹

# å‚è€ƒã«ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
ä»¥ä¸‹ã‚’å‚è€ƒã«ä½œæ¥­ã‚’è¡Œã†ã€‚
https://docs.github.com/ja/actions/deployment/deploying-to-your-cloud-provider/deploying-to-amazon-elastic-container-service

# å‰ææ¡ä»¶
AWSå´ã§æ—¢ã«ECRã‚„ECSã®è¨­å®šãŒã§ãã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚ä»¥ä¸‹ã®è¨˜äº‹ã§è¡Œã£ã¦ã„ã‚‹ã€‚
https://zenn.dev/tofucode/articles/86e37c865d085a

ã¨å…±ã«ã€ã®ã¡ã«è¨­å®šã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’ã“ã“ã§ãƒ¡ãƒ¢ã£ã¦ã„ãã€‚

## ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¿å­˜ã™ã‚‹Amazon ECRãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ
DONE

| ç’°å¢ƒå¤‰æ•° | æ„å‘³ | ä¾‹ |
| - | - | - |
| ECR_REPOSITORY | Amazon ECR ãƒªãƒã‚¸ãƒˆãƒªå | aichatbot-repository |
| AWS_REGION |  AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | ap-northeast-1 |

## Amazon ECS ã‚¿ã‚¹ã‚¯å®šç¾©ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆ
DONE

| ç’°å¢ƒå¤‰æ•° | æ„å‘³ | ä¾‹ |
| - | - | - |
| ECS_SERVICE | Amazon ECS ã‚µãƒ¼ãƒ“ã‚¹ | aichatbot-service |
| ECS_CLUSTER | Amazon ECS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ | aichatbot-cluster |

## Amazon ECS ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ GitHub ãƒªãƒã‚¸ãƒˆãƒªã« JSON ã§ä¿å­˜

```bash
aws ecs register-task-definition --generate-cli-skeleton --family aichatbot-task-familly > ~/git/aichatbot/ecs_task.json
```

| ç’°å¢ƒå¤‰æ•° | æ„å‘³ | ä¾‹ |
| - | - | - |
| ECS_TASK_DEFINITION | ã‚¿ã‚¹ã‚¯å®šç¾©JSONãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹ | .github/workflows/ecs_task.json |
| CONTAINER_NAME | ã‚¿ã‚¹ã‚¯å®šç¾©JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ã€ŒcontainerDefinitionsã€ä»¥ä¸‹ã«ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®name | null?! |

## GitHub Actions ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã—Amazon IAM ã‚¢ã‚¯ã‚»ã‚¹ ã‚­ãƒ¼ã®å€¤ã‚’ä¿å­˜

ä»¥ä¸‹å‚è€ƒã«keyã‚’ä½œæˆã—AWS IAMã«ç™»éŒ²ã™ã‚‹
https://docs.github.com/ja/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository

| ç’°å¢ƒå¤‰æ•° | æ„å‘³ | ä¾‹ |
| - | - | - |
| AWS_ACCESS_KEY_ID | ã‚­ãƒ¼ID |  |
| AWS_SECRET_ACCESS_KEY | ã‚­ãƒ¼ |  |

## ç’°å¢ƒè¨­å®š

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä½œæˆ
