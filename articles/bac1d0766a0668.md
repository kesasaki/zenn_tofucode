---
title: "[APIæŠ€è¡“é¸å®š3] DBé¸å®š"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: 
  - "DB"
  - "DynamoDB"
  - "OracleSQL"
  - "MySQL"
published: true
---

# æ¦‚è¦
APIé–‹ç™ºã«DBã‚’å°å…¥ã™ã‚‹ãŸã‚ã«å€‹äººé–‹ç™ºã§åˆ©ç”¨å¯èƒ½ãªDBã‚’é¸å®šã—ãŸã€‚

# çµè«–
[AWS DynamoDB](https://aws.amazon.com/jp/dynamodb/)ã‚’ä½¿ã†ã€‚

# ç†ç”±
å°è¦æ¨¡ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯æ™®é€šã«RDSã‚’ä½¿ã†ã¨ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚³ã‚¹ãƒˆã®å¤§åŠãŒDBã®é‹ç”¨ç¶­æŒè²»ã«ãªã‚‹ã¯ãšã€‚
Oracleã‚„MySQLã‚’ä½¿ã†ã¨ãªã‚‹ã¨ã©ã®DBã‚‚å€¤æ®µãŒã¨ã£ã¦ã‚‚é«˜ã„ï¼æœˆæ•°åƒå††ã¯ä½™è£•ã§ã‹ã‹ã‚‹ã€‚
ä»¥ä¸‹ã®è¨˜äº‹ãŒã¨ã¦ã‚‚ã¾ã¨ã¾ã£ã¦ã„ã‚‹ã€‚å®Œå…¨åŒæ„ã€‚
https://laiso.hatenablog.com/entry/nope-sql

ãªã®ã§ä»Šå›ã¯SQLã‚’æ¨ã¦ã¦Amazon DynamoDBã‚’åˆ©ç”¨ã™ã‚‹ã€‚
https://aws.amazon.com/jp/dynamodb/

# SDKã¯guregu/dynamo
Goã‹ã‚‰DynamoDBã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã¯[guregu/dynamo](https://github.com/guregu/dynamo)ã‚’åˆ©ç”¨ã™ã‚‹ã€‚ä»¥ä¸‹ã®è¨˜äº‹ãŒ
https://future-architect.github.io/articles/20220601b/#DynamoDB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%ABAWS-SDK-for-Go%E3%82%92%E7%94%9F%E3%81%A7%E4%BD%BF%E3%81%86%E5%BF%85%E8%A6%81%E3%81%AF%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E3%81%AF

DBæ¥ç¶š
```go
sess := session.Must(session.NewSession())
db := dynamo.New(sess, &aws.Config{Region: aws.String("us-west-2")})
table := db.Table("Widgets")
```

ãƒ‡ãƒ¼ã‚¿å®šç¾©
```go
type widget struct {
	UserID int       // Hash key, a.k.a. partition key
	Time   time.Time // Range key, a.k.a. sort key

	Msg       string              `dynamo:"Message"`    // Change name in the database
	Count     int                 `dynamo:",omitempty"` // Omits if zero value
	Children  []widget            // List of maps
	Friends   []string            `dynamo:",set"` // Sets
	Set       map[string]struct{} `dynamo:",set"` // Map sets, too!
	SecretKey string              `dynamo:"-"`    // Ignored
}
```

select
```go
// ä»¥ä¸‹ã®SQL(Oracle)ã¨åŒç¾©
// SELECT
//    UserID
// FROM
//    TABLE
// WHERE
//    Time = w.Time and
//    rownum < 1
var result widget
err = table.Get("UserID", w.UserID).
	Range("Time", dynamo.Equal, w.Time).
	One(&result)
```

select All
```go
var results []widget
err = table.Scan().All(&results)
```

insert
```go
w := widget{UserID: 613, Time: time.Now(), Msg: "hello"}
err := table.Put(w).Run()
```

https://github.com/guregu/dynamo
